var Exception = (function() {
	function ctor() {
		return ctor("");
	}

	function ctor(message) {
		return ctor("Exception", message);
	}
	
	function ctor(exceptionType, message) {
		function subctor(exceptionType, message) {
		}

		function ToString() {
			var stackTrace;
			if(this.Stacktrace != null)
			{
				var rev = this.Stacktrace.Reverse();
				stackTrace = String.Join(Environment.NewLine, rev.Select(function(e, i) return "\t@ " + FunctionInfoToString(e)));
			}
			
			var s;
			if(this.Message == null || this.Message.Length() <= 0)
				s = this.ExceptionType;
			else
				s = this.ExceptionType + ": " + this.Message;
			if(stackTrace != null)
				s += Environment.NewLine + stackTrace;
			return s;
		}

		function FunctionInfoToString(finfo) {
			var ret = finfo.Name;
			var argString = "";
			if(finfo.ParamNames == null && finfo.paramCount > 0)
				argString = finfo.paramCount.ToString();
			else if(finfo.ParamNames != null)
			{
				if(finfo.HasParamsArg)
					finfo.ParamNames[finfo.ParamNames.Length - 1] = "params " +
						finfo.ParamNames[finfo.ParamNames.Length - 1];
				argString = String.Join(", ", finfo.ParamNames);
			}

			ret += "(" + argString + ")";

			return ret + " in " + finfo.CallLocation.Filename + ":Line " + (finfo.CallLocation.Line + 1);
		}

		subctor(exceptionType, message);
		return {
			Message = message,
			ExceptionType = exceptionType,
			Stacktrace = {},
			ToString = ToString
		};
	}

	return ctor;
})();